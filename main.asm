org 0x100

[map all game.map]

        Level_Width equ 11
        Level_Height equ 11

        Tile_Width equ 16
        Tile_Height equ 16

section code

start:
        mov bp, sp
        sub sp, 0xa
.a0 equ -0xa
.x equ 0
.y equ 2
        mov word [bp + .x], 0
        mov word [bp + .y], 0

        mov ax, 0x0013
        int 0x10

        call kb_init
.loop:
        call wait_for_retrace
        call copy_buffer
        call clear_screen

        call draw_tilemap

        cmp byte [key_a], 0
        jz .askip
        cmp word [bp + .x], 0
        jbe .askip
        dec word [bp + .x]
.askip: cmp byte [key_d], 0
        jz .dskip
        inc word [bp + .x]
        cmp word [bp + .x], (Level_Width - 1) * Tile_Width
        jle .dskip
        mov word [bp + .x], (Level_Width - 1) * Tile_Width
.dskip: cmp byte [key_w], 0
        jz .wskip
        dec word [bp + .y]
        jge .wskip
        mov word [bp + .y], 0
.wskip: cmp byte [key_s], 0
        jz .sskip
        inc word [bp + .y]
        cmp word [bp + .y], (Level_Height - 1) * Tile_Height
        jle .sskip
        mov word [bp + .y], (Level_Height - 1) * Tile_Height
.sskip: 

        mov word [bp + .a0], sprite_bomb
        mov ax, [bp + .x]
        mov word [bp + .a0 + 2], ax
        mov ax, [bp + .y]
        mov word [bp + .a0 + 4], ax
        call draw_sprite
        
        jmp .loop

%include "graphics.asm"
%include "keyboard.asm"        
        
tile_block:
        db 0                    ; passable
        db 0                    ; destructible
        db 19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19
        db 19,22,25,25,25,25,25,25,25,25,25,25,25,25,25,19
        db 19,22,23,23,23,23,23,23,23,23,23,23,23,23,25,19
        db 19,22,23,23,23,23,23,26,25,23,23,23,23,23,25,19
        db 19,22,23,23,23,23,26,25,23,23,23,23,23,23,25,19
        db 19,22,23,23,23,23,26,25,23,23,23,23,23,23,25,19
        db 19,22,23,23,23,23,26,25,23,23,23,23,23,23,25,19
        db 19,22,23,23,23,23,23,23,23,23,23,23,23,23,25,19
        db 19,22,23,23,23,26,25,23,23,23,23,26,25,23,25,19
        db 19,22,23,23,26,25,23,23,23,23,26,25,23,23,25,19
        db 19,22,23,23,26,25,23,23,23,23,26,25,23,23,25,19
        db 19,22,23,23,26,25,23,23,23,23,26,25,23,23,25,19
        db 19,22,23,23,23,23,23,23,23,23,23,23,23,23,25,19
        db 19,22,23,23,23,23,23,23,23,23,23,23,23,23,25,19
        db 19,22,22,22,22,22,22,22,22,22,22,22,22,22,22,19
        db 19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19

tile_brick:
        db 0, 1                   ; passable, destructible
        db 17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17
        db 17,22,22,22,19,22,22,22,22,22,22,19,22,22,22,17
        db 17,21,113,113,19,113,113,113,113,113,113,19,113,113,22,17
        db 17,21,113,113,19,113,113,113,113,113,113,19,113,113,22,17
        db 17,21,113,113,19,113,113,113,113,113,113,19,113,113,22,17
        db 17,19,19,19,19,19,19,19,19,19,19,19,19,19,19,17
        db 17,21,22,22,22,22,22,19,22,22,22,22,22,22,19,17
        db 17,21,113,113,113,113,22,19,113,113,113,113,113,22,19,17
        db 17,21,113,113,113,113,22,19,113,113,113,113,113,22,19,17
        db 17,21,113,113,113,113,22,19,113,113,113,113,113,22,19,17
        db 17,19,19,19,19,19,19,19,19,19,19,19,19,19,19,17
        db 17,21,22,22,19,22,22,22,22,22,22,19,22,22,22,17
        db 17,21,113,22,19,113,113,113,113,113,22,19,113,113,22,17
        db 17,21,113,22,19,113,113,113,113,113,22,19,113,113,22,17
        db 17,21,21,21,19,21,21,21,21,21,21,19,21,21,22,17
        db 17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17

tile_ground:
        db 1, 0                 ; passable, destructible
        db 255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255
        db 255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255
        db 255,255,185,255,255,255,185,255,255,255,185,255,255,255,185,255
        db 255,255,185,255,255,255,185,255,255,255,185,255,255,255,185,255
        db 255,255,185,255,255,255,185,255,255,255,185,255,255,255,185,255
        db 255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255
        db 255,255,255,255,185,255,255,255,185,255,255,255,185,255,255,255
        db 255,255,255,255,185,255,255,255,185,255,255,255,185,255,255,255
        db 255,255,255,255,185,255,255,255,185,255,255,255,185,255,255,255
        db 255,255,255,255,185,255,255,255,185,255,255,255,185,255,255,255
        db 255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255
        db 255,255,185,255,255,255,185,255,255,255,185,255,255,255,185,255
        db 255,255,185,255,255,255,185,255,255,255,185,255,255,255,185,255
        db 255,255,185,255,255,255,185,255,255,255,185,255,255,255,185,255
        db 255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255
        db 255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255

sprite_bomb:
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	db 0,0,0,0,0,0,0,0,0,44,44,0,0,0,0,0
	db 0,0,0,0,0,0,0,44,43,43,0,0,0,0,0,0
	db 0,0,0,0,0,0,0,41,43,41,0,0,0,0,0,0
	db 0,0,0,0,0,0,16,41,41,0,0,0,0,0,0,0
	db 0,0,0,0,0,16,22,185,22,16,0,0,0,0,0,0
	db 0,0,0,0,16,22,22,185,22,22,16,0,0,0,0,0
	db 0,0,0,16,22,22,22,22,22,22,22,16,0,0,0,0
	db 0,0,0,19,22,22,22,22,22,22,22,16,0,0,0,0
	db 0,0,0,19,22,22,22,22,22,22,22,16,0,0,0,0
	db 0,0,0,0,19,22,22,22,22,22,16,0,0,0,0,0
	db 0,0,0,0,0,19,22,22,22,19,0,0,0,0,0,0
	db 0,0,0,0,0,0,19,19,19,0,0,0,0,0,0,0
	db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        
tiles:
        dw tile_ground, tile_block, tile_brick

tile_map:
        db 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0
        db 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2
        db 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0
        db 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2
        db 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0
        db 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2
        db 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0
        db 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2
        db 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0
        db 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2
        db 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0
